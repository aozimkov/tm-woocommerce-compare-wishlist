!function(t){"use strict";t(document).ready(function(){function e(){t(i).each(function(){var e=t(this);e.on("click",function(a){a.preventDefault();var n=tmWoocompare.ajaxurl,c={action:"tm_woocompare_add_to_list",pid:e.data("id"),nonce:e.data("nonce"),single:e.hasClass("tm-woocompare-button-single")};e.removeClass(p).addClass(s),t.post(n,c,function(a){if(e.removeClass(s),a.success){switch(a.data.action){case"add":t(i+"[data-id="+c.pid+"]").addClass(p).find(".text").text(tmWoocompare.removeText),a.data.comparePageBtn&&e.after(a.data.comparePageBtn);break;case"remove":t(i+"[data-id="+c.pid+"]").removeClass(p).find(".text").text(tmWoocompare.compareText),t(".tm-woocompare-page-button").remove()}c={action:"tm_woocompare_update"},o(null,c)}void 0!==a.data.counts&&t(document).trigger("tm_compare_update_fragments",{response:a.data.counts})})})})}function o(e,o){e&&e.preventDefault();var a=tmWoocompare.ajaxurl,n=t("div.tm-woocompare-widget-wrapper"),m=t("div.tm-woocompare-list");o.isComparePage=!!m.length,o.isWidget=!!n.length,("tm_woocompare_update"!==o.action||o.isComparePage||o.isWidget)&&(m.addClass(s),n.addClass(s),t.post(a,o,function(e){m.removeClass(s),n.removeClass(s),e.success&&(o.isComparePage&&(t("div.tm-woocompare-wrapper").html(e.data.compareList),t(document).trigger("enhance.tablesaw")),o.isWidget&&n.html(e.data.widget),"tm_woocompare_empty"===o.action&&(t(i).removeClass(p).find(".text").text(tmWoocompare.compareText),t(".tm-woocompare-page-button").remove()),"tm_woocompare_remove"===o.action&&(t(i+"[data-id="+o.pid+"]").removeClass(p).find(".text").text(tmWoocompare.compareText),t(".tm-woocompare-page-button").remove())),void 0!==e.data.counts&&t(document).trigger("tm_compare_update_fragments",{response:e.data.counts}),c()}))}function a(e){var a=t(e.currentTarget),n={action:"tm_woocompare_remove",pid:a.data("id"),nonce:a.data("nonce")};o(e,n)}function n(t){var e={action:"tm_woocompare_empty"};o(t,e)}function c(){t(".tm-woocompare-remove").off("click").on("click",function(t){a(t)}),t(".tm-woocompare-empty").off("click").on("click",function(t){n(t)})}function m(){t.ajax({url:tmWoocompare.ajaxurl,type:"get",dataType:"json",data:{action:"tm_compare_get_fragments"}}).done(function(e){t(document).trigger("tm_compare_update_fragments",{response:e.data})})}function r(e,o){t.isEmptyObject(o.response.defaultFragments)||t.each(o.response.defaultFragments,function(e,o){var a=t(e),n=t(".compare-count",a);0===n.length?a.append(tmWoocompare.countFormat.replace("%count%",o)):a.find(".compare-count").html(o)}),t.isEmptyObject(o.response.customFragments)||t.each(o.response.customFragments,function(e,o){var a=t(e);a.length&&a.html(o)})}var s="loading",p="added in_compare",i="button.tm-woocompare-button";t(document).on("tm_compare_update_fragments",r),c(),e(),m(),t(document).on("tm_wc_products_changed",function(){c(),e()})})}(jQuery);